<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡è³¼æµç¨‹é€²åº¦è¿½è¹¤ - æ¸¬è©¦ç‰ˆ</title>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f4f7f6; padding: 20px; }
        .container { max-width: 1000px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* æ¨™é¡Œèˆ‡ç¯©é¸å€ */
        .header-section { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 10px; }
        .filter-group { background: #f9f9f9; padding: 10px; border-radius: 5px; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background-color: #007bff; color: white; padding: 12px; text-align: center; }
        td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        tr:nth-child(even) { background-color: #fcfcfc; }

        /* ç‹€æ…‹æ¨™ç±¤é¡è‰² */
        .badge { padding: 5px 10px; border-radius: 12px; color: white; font-size: 13px; font-weight: bold; }
        .bg-wait { background-color: #6c757d; } /* å¾…è™•ç† */
        .bg-pur  { background-color: #17a2b8; } /* å·²è«‹è³¼ */
        .bg-sap  { background-color: #6f42c1; } /* å·²æ¡è³¼ */
        .bg-done { background-color: #28a745; } /* å·²å®Œæˆ */

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { cursor: pointer; border: none; padding: 6px 12px; border-radius: 4px; transition: 0.3s; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-refresh { background-color: #4CAF50; color: white; margin-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h2>ğŸ“¦ æ¡è³¼é€²åº¦è¿½è¹¤ Tab</h2>
        <div class="filter-group">
            <label>ç‹€æ…‹ç¯©é¸ï¼š</label>
            <select id="statusFilter" onchange="renderTable()">
                <option value="All">å…¨éƒ¨</option>
                <option value="å¾…è«‹è³¼">å¾…è«‹è³¼</option>
                <option value="å·²è«‹è³¼">å·²è«‹è³¼</option>
                <option value="å·²æ¡è³¼">å·²æ¡è³¼</option>
                <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
            </select>
            <button class="btn btn-refresh" onclick="location.reload()">ğŸ”„ åˆ·æ–°é é¢</button>
        </div>
    </div>

    <table id="purchaseTable">
        <thead>
            <tr>
                <th>è¨‚å–®ç·¨è™Ÿ/å‚™åº«å­˜</th>
                <th>ç‹€æ…‹</th>
                <th>PURå–®è™Ÿ</th>
                <th>SAPå–®è™Ÿ</th>
                <th>ä¸‹å–®æ™‚é–“</th>
                <th>åŸ·è¡Œæ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>
</div>

<script>
    // --- æ¸¬è©¦ç”¨æ¨¡æ“¬è³‡æ–™ (é€™éƒ¨åˆ†ä¹‹å¾Œæœƒæ›æˆè®€å– Google Sheet) ---
    let mockData = [
        { id: "A2024001", pur: "", sap: "", qia: "", time: "", status: "å¾…è«‹è³¼", note: "" },
        { id: "A2024002", pur: "PUR-9988", sap: "", qia: "", time: "", status: "å·²è«‹è³¼", note: "" },
        { id: "å‚™åº«å­˜-C1", pur: "PUR-7766", sap: "SAP-12345", qia: "Q-443", time: "2024/05/20 14:00", status: "å·²æ¡è³¼", note: "" }
    ];

    // æ¸²æŸ“è¡¨æ ¼å‡½å¼
    function renderTable() {
        const tbody = document.getElementById('tableBody');
        const filterValue = document.getElementById('statusFilter').value;
        tbody.innerHTML = '';

        mockData.forEach((item, index) => {
            if (filterValue !== "All" && item.status !== filterValue) return;

            let badgeClass = "";
            let actionBtn = "";

            // æ ¹æ“šç‹€æ…‹åˆ¤æ–·é¡è‰²èˆ‡æŒ‰éˆ•
            if (item.status === "å¾…è«‹è³¼") {
                badgeClass = "bg-wait";
                actionBtn = `<button class="btn btn-primary" onclick="updateStep(${index}, 'pur')">å¡«å¯« PUR å–®</button>`;
            } else if (item.status === "å·²è«‹è³¼") {
                badgeClass = "bg-pur";
                actionBtn = `<button class="btn btn-primary" onclick="updateStep(${index}, 'sap')">å¡«å¯« SAP å–®</button>`;
            } else if (item.status === "å·²æ¡è³¼") {
                badgeClass = "bg-sap";
                actionBtn = `<button class="btn btn-primary" onclick="updateStep(${index}, 'done')">çµæ¡ˆå®Œæˆ</button>`;
            } else {
                badgeClass = "bg-done";
                actionBtn = `<span style="color:#aaa">æµç¨‹çµæŸ</span>`;
            }

            const tr = `
                <tr>
                    <td><strong>${item.id}</strong></td>
                    <td><span class="badge ${badgeClass}">${item.status}</span></td>
                    <td>${item.pur || '-'}</td>
                    <td>${item.sap || '-'}</td>
                    <td>${item.time || '-'}</td>
                    <td>${actionBtn}</td>
                </tr>
            `;
            tbody.innerHTML += tr;
        });
    }

    // æ¨¡æ“¬æ“ä½œæµç¨‹
    function updateStep(index, type) {
        const item = mockData[index];
        
        if (type === 'pur') {
            const purId = prompt("è«‹è¼¸å…¥ PUR å–®è™Ÿï¼š");
            if (purId) {
                item.pur = purId;
                item.status = "å·²è«‹è³¼";
            }
        } else if (type === 'sap') {
            const sapId = prompt("è«‹è¼¸å…¥ SAP å–®è™Ÿï¼š");
            if (sapId) {
                item.sap = sapId;
                item.status = "å·²æ¡è³¼";
                item.time = new Date().toLocaleString(); // è‡ªå‹•è¨˜éŒ„ç•¶ä¸‹æ™‚é–“
            }
        } else if (type === 'done') {
            if (confirm("ç¢ºå®šå®Œæˆæ­¤ç­†è¨‚å–®ï¼Ÿ")) {
                item.status = "å·²å®Œæˆ";
            }
        }
        
        renderTable(); // é‡æ–°æ¸²æŸ“ç•«é¢
        console.log("æœ€æ–°è³‡æ–™ç‹€æ…‹ï¼š", mockData);
    }

    // åˆå§‹è¼‰å…¥
    renderTable();
</script>

</body>
</html>
